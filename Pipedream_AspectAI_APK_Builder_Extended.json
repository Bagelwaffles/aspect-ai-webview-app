{
  "name": "Aspect AI APK Builder Extended",
  "description": "Builds APK and AAB, generates Play Store assets, and returns download links.",
  "steps": [
    {
      "name": "trigger",
      "type": "trigger",
      "component": "http",
      "config": {
        "method": "POST",
        "path": "/build-apk-extended"
      }
    },
    {
      "name": "decode_and_save_zip",
      "type": "action",
      "component": "code",
      "config": {
        "language": "nodejs",
        "code": "\nconst fs = require('fs');\nconst { execSync } = require('child_process');\n\n// Save base64 ZIP\nconst zipBase64 = event.body.zipBase64;\nconst zipPath = '/tmp/aspect_ai_app.zip';\nfs.writeFileSync(zipPath, Buffer.from(zipBase64, 'base64'));\n\n// Extract\nexecSync(`cd /tmp && unzip -o aspect_ai_app.zip -d aspect_ai_app`);\nreturn { message: 'Source code extracted successfully', zipPath };\n"
      }
    },
    {
      "name": "build_apk_aab",
      "type": "action",
      "component": "code",
      "config": {
        "language": "nodejs",
        "code": "\nconst { execSync } = require('child_process');\n\ntry {\n  execSync('cd /tmp/aspect_ai_app && ./gradlew assembleRelease', { stdio: 'inherit' });\n  execSync('cd /tmp/aspect_ai_app && ./gradlew bundleRelease', { stdio: 'inherit' });\n\n  const apkPath = '/tmp/aspect_ai_app/app/build/outputs/apk/release/app-release.apk';\n  const aabPath = '/tmp/aspect_ai_app/app/build/outputs/bundle/release/app-release.aab';\n\n  return { apkPath, aabPath };\n} catch (error) {\n  return { error: error.message };\n}\n"
      }
    },
    {
      "name": "generate_playstore_assets",
      "type": "action",
      "component": "code",
      "config": {
        "language": "nodejs",
        "code": "\nconst fs = require('fs');\nconst path = require('path');\n\n// Placeholder assets\nfs.writeFileSync('/tmp/app_icon.png', 'ICON_PLACEHOLDER');\nfs.writeFileSync('/tmp/feature_banner.png', 'BANNER_PLACEHOLDER');\nfs.writeFileSync('/tmp/screenshot_1.png', 'SCREENSHOT1_PLACEHOLDER');\nfs.writeFileSync('/tmp/screenshot_2.png', 'SCREENSHOT2_PLACEHOLDER');\n\n// Privacy policy and metadata\nfs.writeFileSync('/tmp/privacy_policy.txt', 'Privacy Policy for Aspect AI App...');\nfs.writeFileSync('/tmp/playstore_metadata.txt', 'Aspect AI App: WebView + Admin PIN.');\n\nreturn {\n  assets: ['app_icon.png', 'feature_banner.png', 'screenshot_1.png', 'screenshot_2.png'],\n  policy: 'privacy_policy.txt',\n  metadata: 'playstore_metadata.txt'\n};\n"
      }
    },
    {
      "name": "upload_results",
      "type": "action",
      "component": "code",
      "config": {
        "language": "nodejs",
        "code": "\nconst fs = require('fs');\n\nfunction toBase64(file) {\n  return fs.readFileSync(file).toString('base64');\n}\n\nreturn {\n  apkBase64: toBase64('/tmp/aspect_ai_app/app/build/outputs/apk/release/app-release.apk'),\n  aabBase64: toBase64('/tmp/aspect_ai_app/app/build/outputs/bundle/release/app-release.aab'),\n  assets: {\n    icon: toBase64('/tmp/app_icon.png'),\n    banner: toBase64('/tmp/feature_banner.png'),\n    screenshot1: toBase64('/tmp/screenshot_1.png'),\n    screenshot2: toBase64('/tmp/screenshot_2.png')\n  },\n  metadata: fs.readFileSync('/tmp/playstore_metadata.txt', 'utf-8'),\n  privacy_policy: fs.readFileSync('/tmp/privacy_policy.txt', 'utf-8')\n};\n"
      }
    }
  ]
}
